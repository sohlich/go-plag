db.submissions.aggregate([{$match:{"assignment":"55c7b6ebe13823356f000001"}},{$unwind: "$tokens"},{$project:{"token":"$tokens"}},{$group:{"_id":{"id":"$_id","token":"$token"},"count":{"$sum":1}}},{$group:{"_id":"$_id","tokenArr":{$push:"$_id.token"},"countArr":{$push: "$count"}}},{$project:{"_id":"$_id.id","fp":{$setUnion:["$tokenArr","$countArr"]}}},{$group:{"_id":"$_id","map":{$addToSet:"$fp"}}}])
